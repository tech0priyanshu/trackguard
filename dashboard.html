<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Dashboard with Real-time Graphs</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f6f8;
            color: #333;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            color: #333;
            font-size: 36px;
        }

        /* Navigation Bar */
        nav {
            background-color: #2c3e50;
            padding: 15px 0;
            text-align: center;
        }

        nav a {
            color: #ecf0f1;
            margin: 0 20px;
            font-size: 18px;
            text-decoration: none;
        }

        nav a:hover {
            color: #3498db;
        }

        /* Dashboard Container */
        #dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
            padding-bottom: 100px; /* Add bottom padding to prevent overlap */
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .active {
            display: block;
        }

        .card h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        #map {
            height: 300px;
            width: 100%;
            border-radius: 8px;
        }

        /* Footer */
        footer {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            text-align: center;
            width: 100%;
            position: relative; /* Change from fixed to relative */
            bottom: 0;
        }

        footer a {
            color: #3498db;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <!-- Navigation Bar -->
    <nav>
        <a href="#line-chart-card">ECG Graph <a href="ecg.html">More about ECG</a></a>
        <a href="#activity-chart-card">Activity Levels</a>
        <a href="#pie-chart-card">Delivery Timings</a>
        <a href="#map-card">Current Location</a>
        <a href="#device-status-card">Device Status</a>
    </nav>

    <h1>Live Dashboard</h1>

    <div id="dashboard">
        <!-- Card 1: ECG Graph -->
        <div id="line-chart-card" class="card active">
            <h3>ECG Graph (Electrocardiogram)</h3>
            <div id="ecg-graph"></div>
        </div>

        <!-- Card 2: Activity Levels (New Content) -->
        <div id="activity-chart-card" class="card">
            <h3>Vehicle Activity Levels</h3>
            <div id="activity-chart"></div>
        </div>

        <!-- Card 3: Delivery Timings (Pie Chart) -->
        <div id="pie-chart-card" class="card">
            <h3>Delivery Timings Distribution</h3>
            <div id="pie-chart"></div>
        </div>

        <!-- Card 4: Current Location on Map -->
        <div id="map-card" class="card">
            <h3>Current Location</h3>
            <div id="map"></div>
        </div>

        <!-- Card 5: Device Status (Bar Graph) -->
        <div id="device-status-card" class="card">
            <h3>Device Status</h3>
            <div id="device-status-graph"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>©️ 2024 TrackGuard. All rights reserved.</p>
    </footer>

    <script>
        let currentCardIndex = 0;

        // ECG Data (mV)
        const ecgData = {
            time: Array.from({length: 100}, (_, i) => new Date(Date.now() + i * 1000)),
            values: Array.from({length: 100}, (_, i) => (i % 10 === 0 ? Math.abs(Math.sin(i * 0.1)) * 0.5 : 0)),
        };

        // Vehicle Activity Data (for Activity Levels Chart)
        const activityData = {
            categories: ['Idle', 'In Motion', 'Stopped', 'Off Route'],
            values: [25, 50, 15, 10]  // Percentage of time spent in each state
        };

        // Delivery Timings Data (Pie Chart)
        const deliveryTimingsData = {
            labels: ['On-time Delivery', 'Delayed Delivery', 'Early Delivery', 'Canceled Delivery'],
            values: [50, 30, 10, 10],  // Percentages for each category
        };

        // Device Status Data (for Bar Graph)
        const deviceStatusData = {
            status: ['Active', 'Inactive', 'Partially Active'],
            counts: [45, 30, 25]  // Number of devices in each state
        };

        // Function to Update Graphs
        function updateGraphs() {
            // ECG Graph (Line Chart)
            const ecgTrace = {
                x: ecgData.time,
                y: ecgData.values,
                mode: 'lines',
                name: 'ECG (mV)',
                line: {color: 'rgb(255, 99, 132)'}
            };

            const layoutECG = {
                title: 'ECG (Electrocardiogram)',
                xaxis: {
                    title: 'Time',
                    type: 'date',
                    showgrid: true,
                    zeroline: true
                },
                yaxis: {
                    title: 'ECG (mV)',
                    range: [0, 1],
                    showgrid: true,
                    zeroline: true
                },
            };

            // Activity Levels Graph (Bar Chart)
            const activityTrace = {
                x: activityData.categories,
                y: activityData.values,
                type: 'bar',
                marker: {color: 'rgb(54, 162, 235)'}
            };

            const layoutActivity = {
                title: 'Vehicle Activity Levels',
                xaxis: {
                    title: 'Activity Type',
                    showgrid: true,
                    zeroline: true
                },
                yaxis: {
                    title: 'Percentage (%)',
                    range: [0, 100],
                    showgrid: true,
                    zeroline: true
                },
            };

            // Delivery Timings Distribution (Pie Chart)
            const pieTrace = {
                labels: deliveryTimingsData.labels,
                values: deliveryTimingsData.values,
                type: 'pie'
            };

            const layoutPie = {
                title: 'Delivery Timings Distribution',
            };

            // Device Status Bar Graph
            const deviceStatusTrace = {
                x: deviceStatusData.status,
                y: deviceStatusData.counts,
                type: 'bar',
                marker: {color: 'rgb(75, 192, 192)'}
            };

            const layoutDeviceStatus = {
                title: 'Device Status Distribution',
                xaxis: {
                    title: 'Device Status',
                    showgrid: true,
                    zeroline: true
                },
                yaxis: {
                    title: 'Number of Devices',
                    showgrid: true,
                    zeroline: true
                },
            };

            // Plot the ECG Graph
            Plotly.newPlot('ecg-graph', [ecgTrace], layoutECG);

            // Plot the Activity Levels Graph
            Plotly.newPlot('activity-chart', [activityTrace], layoutActivity);

            // Plot the Pie Chart
            Plotly.newPlot('pie-chart', [pieTrace], layoutPie);

            // Plot the Device Status Graph
            Plotly.newPlot('device-status-graph', [deviceStatusTrace], layoutDeviceStatus);
        }

        // Current Location Map
        let map, marker;
        function updateLocationOnMap() {
            map = L.map('map').setView([20.5937, 78.9629], 5); // Center on India

            // Add OpenStreetMap tile layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Set initial marker position and popup
            marker = L.marker([28.6139, 77.2090]).addTo(map);
            marker.bindPopup('The driver is here').openPopup();

            // Simulate random movement of the marker
            setInterval(() => {
                const lat = 20.5937 + (Math.random() - 0.5) * 10; // Random latitude
                const lon = 78.9629 + (Math.random() - 0.5) * 10; // Random longitude

                marker.setLatLng([lat, lon]);
                map.setView([lat, lon], 5);
                marker.getPopup().setContent("The driver is here");
            }, 5000); // Update every 5 seconds
        }

        // Switch between active cards
        function switchCard() {
            const cards = ['line-chart-card', 'activity-chart-card', 'pie-chart-card', 'map-card', 'device-status-card'];
            cards.forEach(card => document.getElementById(card).classList.remove('active'));
            document.getElementById(cards[currentCardIndex]).classList.add('active');
            currentCardIndex = (currentCardIndex + 1) % cards.length;
        }

        // Initialize and Update
        setInterval(() => {
            updateGraphs();
            switchCard();
        }, 5000);
        
        // Initial function calls
        updateLocationOnMap();
        updateGraphs();
    </script>
</body>
</html>
